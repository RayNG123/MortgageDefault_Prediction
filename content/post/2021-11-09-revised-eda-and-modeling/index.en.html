---
title: Revised EDA and Modeling
author: Ke Lan
date: '2021-11-09'
slug: []
categories: []
tags: []
description: starting a construct a model to predict default rate of certain mortgage
toc: yes
authors: []
series: []
lastmod: '2021-11-09T11:56:01-05:00'
featuredVideo: ~
featuredImage: ~
---

<script src="{{< blogdown/postref >}}index.en_files/header-attrs/header-attrs.js"></script>

<div id="TOC">

</div>

<p>The map in last blog post is a little hard to make too much sense of since it largely just reflects population, so we revised it.</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.5     ✓ purrr   0.3.4
## ✓ tibble  3.1.2     ✓ dplyr   1.0.7
## ✓ tidyr   1.1.4     ✓ stringr 1.4.0
## ✓ readr   2.0.1     ✓ forcats 0.5.1</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(sf)</code></pre>
<pre><code>## Linking to GEOS 3.8.1, GDAL 3.2.1, PROJ 7.2.1</code></pre>
<pre class="r"><code>library(tmap)</code></pre>
<pre><code>## Registered S3 methods overwritten by &#39;stars&#39;:
##   method             from
##   st_bbox.SpatRaster sf  
##   st_crs.SpatRaster  sf</code></pre>
<pre class="r"><code>library(formattable)
mortgage &lt;-read_csv(here::here(&#39;dataset&#39;,&#39;dcr_clean.csv&#39;))</code></pre>
<pre><code>## Rows: 619660 Columns: 32</code></pre>
<pre><code>## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (3): state_orig_time, month, day
## dbl (29): id, time, orig_time, first_time, mat_time, res_time, balance_time,...</code></pre>
<pre><code>## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code>mortgage_last&lt;-mortgage %&gt;% group_by(id) %&gt;%  summarise_all(last) 
epsg_us_equal_area &lt;- 2163
us_states &lt;- st_read(here::here(&quot;dataset/cb_2019_us_state_20m/cb_2019_us_state_20m.shp&quot;))%&gt;% 
  st_transform(epsg_us_equal_area)</code></pre>
<pre><code>## Reading layer `cb_2019_us_state_20m&#39; from data source 
##   `/Users/alex/Desktop/fa2021-final-project-digfora/dataset/cb_2019_us_state_20m/cb_2019_us_state_20m.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 52 features and 9 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -179.1743 ymin: 17.91377 xmax: 179.7739 ymax: 71.35256
## Geodetic CRS:  NAD83</code></pre>
<pre class="r"><code>not_contiguous &lt;-
  c(&quot;Guam&quot;, &quot;Commonwealth of the Northern Mariana Islands&quot;,
    &quot;American Samoa&quot;, &quot;Puerto Rico&quot;, &quot;Alaska&quot;, &quot;Hawaii&quot;,
    &quot;United States Virgin Islands&quot;)

us_cont &lt;- us_states %&gt;%
  filter(!NAME %in% not_contiguous) %&gt;% filter(NAME != &quot;District of Columbia&quot;) %&gt;%
  transmute(STUSPS,STATEFP,NAME, geometry)
p &lt;- mortgage %&gt;% group_by(state_orig_time) %&gt;% summarize(count = n(),def = sum(status_time[status_time == 1])) %&gt;% mutate(proportion = formattable::percent(def / count))
us_cont %&gt;% inner_join(p, by = c(&quot;STUSPS&quot; = &quot;state_orig_time&quot;)) %&gt;% tm_shape() + tm_polygons(col = &quot;proportion&quot;,palette = &quot;RdBu&quot;) + tm_text(&quot;STUSPS&quot;, size = 1/2) + tm_layout(title= &#39;percentage of number of default&#39;)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre class="r"><code>q &lt;- mortgage %&gt;% group_by(state_orig_time) %&gt;% summarize(total = sum(balance_orig_time),def = sum(balance_orig_time[status_time == 1])) %&gt;% mutate(proportion = formattable::percent(def / total))
us_cont %&gt;% inner_join(q, by = c(&quot;STUSPS&quot; = &quot;state_orig_time&quot;)) %&gt;% tm_shape() + tm_polygons(col = &quot;proportion&quot;,palette = &quot;RdBu&quot;) +  tm_text(&quot;STUSPS&quot;, size = 1/2) +  tm_layout(title= &#39;percentage of default amount&#39;)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-1-2.png" width="672" /></p>
<p>For this week, we are starting a construct a model to predict default rate of certain mortgage. Since we have a panel dataset–multiple records refer to a same mortgage over different period. We would not know whether a mortgage is default or payoff until we see last record of this mortgage. Therefore, it is a little bit complicated for us to build a logistic linear regression. We then decided to normalized the dataset again and try to collapse them to build a dataset with have only one record for one mortgage, including their start time, end time, their age,avergae GDP during the mortgage, status at last(default or pay off) and etc.</p>
<p>Firstly, we would like to determine the start time, age, time to maturity of
We start by loading the dataset and packages:</p>
<pre class="r"><code>library(tidyverse)
mortgage &lt;- read_csv(here::here(&#39;dataset&#39;,&#39;dcr_clean.csv&#39;))</code></pre>
<pre><code>## Rows: 619660 Columns: 32</code></pre>
<pre><code>## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (3): state_orig_time, month, day
## dbl (29): id, time, orig_time, first_time, mat_time, res_time, balance_time,...</code></pre>
<pre><code>## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code>#create a new column for the age of a mortgage
mortgage$age&lt;- mortgage$time-mortgage$orig_time
#create a new column for the time to maturity of a mortgage
mortgage$TTM&lt;-mortgage$mat_time-mortgage$orig_time
#create a continuous time variable for each records
mortgage$date=paste(as.character(mortgage$year),as.character(mortgage$month),as.character(mortgage$day),sep=&#39;-&#39;)
#found out the first-time record for all mortgages
mortgage_first&lt;-mortgage[match(unique(mortgage$id), mortgage$id),]
#create a column for start time of each mortgage
mortgage_first$first_time_date&lt;-mortgage_first$date
mortgage_first$first_time&lt;-mortgage_first$time
#leave only the collumn that contains first time data of the mortgage
first &lt;- mortgage_first %&gt;% select(id, first_time, orig_time,mat_time,rate_time,REtype_CO_orig_time,REtype_PU_orig_time,REtype_SF_orig_time,investor_orig_time,balance_orig_time:Interest_Rate_orig_time,state_orig_time,hpi_orig_time,first_time_date, age, TTM)</code></pre>
<p>As followed, we would like to determine the ending status of each mortgage(defualt, pay off or unfnished):</p>
<pre class="r"><code>#Get the last record for all mortgages in the dataset
get_last &lt;- mortgage %&gt;% select(id,date,time,default_time,payoff_time,status_time) %&gt;% group_by(id) %&gt;% summarise_all(last)
#determine the end time of a mortgage
get_last$last_time_date&lt;-get_last$date
get_last$last_time&lt;-get_last$time
#determine the status of the mortgage
get_last$status_last&lt;-get_last$status_time
atlast &lt;- get_last %&gt;% select(id,last_time_date:status_last,default_time)</code></pre>
<p>As followed, we would like to get the mean value of GDP growth, Unemployment Rate, Risk_free rate, interest rate, house price index for each mortgage from their start to their end.</p>
<pre class="r"><code>meanvalue &lt;- mortgage %&gt;% group_by(id) %&gt;% summarise(interest_rate_mean = mean(interest_rate_time),gdp_mean = mean(gdp_time), risk_free_mean = mean(rate_time),hpi_mean = mean(hpi_time),uer_mean = mean(uer_time))</code></pre>
<p>Now We would like to join the three dataset together to form the new dataset with one record for one mortgage:</p>
<pre class="r"><code>mortgage_all &lt;- first %&gt;% left_join(atlast, by = &#39;id&#39;) %&gt;% left_join(meanvalue, by = &#39;id&#39;)</code></pre>
<p>We would like to add one more variable, time between the start of the mortgage and global financial crisis(time 37) to measure the influence of Financial Crisis to the mortgage</p>
<pre class="r"><code>mortgage_all$time_to_GFC &lt;- 37-mortgage_all$first_time</code></pre>
<p>Here is the column expalnation of our new datasets.</p>
<pre class="r"><code>newstr&lt;-&#39;id:borrower id
first_time:time stamp for first observation
orig_time:time stamp for origination
mat_time:time stamp for maturity
rate_time:risk-free rate
REtype_CO_orig_time:real estate type condominium: 1, otherwise: 0
REtype_PU_orig_time:real estate type planned urban developments: 1, otherwise: 0
REtype_SF_orig_time:single family home: 1, otherwise: 0
investor_orig_time:investor borrower: 1, otherwise: 0
balance_orig_time:outstanding balance at origination time
FICO_orig_time:FICO score at origination time, in %
LTV_orig_time:loan to value ratio at origination time, in %
Interest_Rate_orig_time:interest rate at origination time, in %
state_orig_time:US state in which the property is located
hpi_orig_time:house price index at observation time, base year=100
first_time_date:date of the first observation
age:number of periods from origination to time of observation
TTM:time to maturity at the time of observation
last_time_date:date of the last observation
last_time:time stamp for the last observation
status_last:debt status at the last observation: 0 is unfinished, 1 is default, 2 is paidoff
interest_rate_mean:the average interest rate of all observation periods
gdp_mean:the average GDP growth of all observation periods
risk_free_mean:the average risk free rate of all observation periods
hpi_mean:the average house price index of all observation periods
uer_mean:the average unemployment rate of all observation periods
time_to_GFC:number of periods from first observation to global financial crisis&#39;

lista&lt;-str_split(newstr, &quot;\n&quot;)
keydataname&lt;-data.frame(lista)
colnames(keydataname)&lt;-&#39;dataname&#39;
keydataname&lt;-keydataname %&gt;% separate(dataname,into=c(&#39;Column Name&#39;,&#39;Description&#39;),sep=&#39;:&#39;)</code></pre>
<pre><code>## Warning: Expected 2 pieces. Additional pieces discarded in 5 rows [6, 7, 8, 9,
## 21].</code></pre>
<pre class="r"><code>as.tibble(keydataname) %&gt;%knitr::kable()</code></pre>
<pre><code>## Warning: `as.tibble()` was deprecated in tibble 2.0.0.
## Please use `as_tibble()` instead.
## The signature and semantics have changed, see `?as_tibble`.</code></pre>
<table>
<colgroup>
<col width="26%" />
<col width="73%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Column Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">id</td>
<td align="left">borrower id</td>
</tr>
<tr class="even">
<td align="left">first_time</td>
<td align="left">time stamp for first observation</td>
</tr>
<tr class="odd">
<td align="left">orig_time</td>
<td align="left">time stamp for origination</td>
</tr>
<tr class="even">
<td align="left">mat_time</td>
<td align="left">time stamp for maturity</td>
</tr>
<tr class="odd">
<td align="left">rate_time</td>
<td align="left">risk-free rate</td>
</tr>
<tr class="even">
<td align="left">REtype_CO_orig_time</td>
<td align="left">real estate type condominium</td>
</tr>
<tr class="odd">
<td align="left">REtype_PU_orig_time</td>
<td align="left">real estate type planned urban developments</td>
</tr>
<tr class="even">
<td align="left">REtype_SF_orig_time</td>
<td align="left">single family home</td>
</tr>
<tr class="odd">
<td align="left">investor_orig_time</td>
<td align="left">investor borrower</td>
</tr>
<tr class="even">
<td align="left">balance_orig_time</td>
<td align="left">outstanding balance at origination time</td>
</tr>
<tr class="odd">
<td align="left">FICO_orig_time</td>
<td align="left">FICO score at origination time, in %</td>
</tr>
<tr class="even">
<td align="left">LTV_orig_time</td>
<td align="left">loan to value ratio at origination time, in %</td>
</tr>
<tr class="odd">
<td align="left">Interest_Rate_orig_time</td>
<td align="left">interest rate at origination time, in %</td>
</tr>
<tr class="even">
<td align="left">state_orig_time</td>
<td align="left">US state in which the property is located</td>
</tr>
<tr class="odd">
<td align="left">hpi_orig_time</td>
<td align="left">house price index at observation time, base year=100</td>
</tr>
<tr class="even">
<td align="left">first_time_date</td>
<td align="left">date of the first observation</td>
</tr>
<tr class="odd">
<td align="left">age</td>
<td align="left">number of periods from origination to time of observation</td>
</tr>
<tr class="even">
<td align="left">TTM</td>
<td align="left">time to maturity at the time of observation</td>
</tr>
<tr class="odd">
<td align="left">last_time_date</td>
<td align="left">date of the last observation</td>
</tr>
<tr class="even">
<td align="left">last_time</td>
<td align="left">time stamp for the last observation</td>
</tr>
<tr class="odd">
<td align="left">status_last</td>
<td align="left">debt status at the last observation</td>
</tr>
<tr class="even">
<td align="left">interest_rate_mean</td>
<td align="left">the average interest rate of all observation periods</td>
</tr>
<tr class="odd">
<td align="left">gdp_mean</td>
<td align="left">the average GDP growth of all observation periods</td>
</tr>
<tr class="even">
<td align="left">risk_free_mean</td>
<td align="left">the average risk free rate of all observation periods</td>
</tr>
<tr class="odd">
<td align="left">hpi_mean</td>
<td align="left">the average house price index of all observation periods</td>
</tr>
<tr class="even">
<td align="left">uer_mean</td>
<td align="left">the average unemployment rate of all observation periods</td>
</tr>
<tr class="odd">
<td align="left">time_to_GFC</td>
<td align="left">number of periods from first observation to global financial crisis</td>
</tr>
</tbody>
</table>
<p>Now, we will need to filter out mortgages that are unfinished.</p>
<pre class="r"><code>mortgage_all &lt;- mortgage_all %&gt;% filter(status_last != 0)</code></pre>
<p>Some of the columns that are not included will be discussed in the future.Now, with the new collapsed dataset, we can start constructing our model. Firstly, we would like to construct a correlation table to determine which varible to be included in our regression fuction.</p>
<pre class="r"><code>variable_subset &lt;- mortgage_all[c(&#39;first_time&#39;,&#39;orig_time&#39;,&#39;mat_time&#39;,&#39;rate_time&#39;,&#39;REtype_CO_orig_time&#39;,&#39;REtype_PU_orig_time&#39;,&#39;REtype_SF_orig_time&#39;,&#39;investor_orig_time&#39;,&#39;balance_orig_time&#39;,&#39;FICO_orig_time&#39;,&#39;LTV_orig_time&#39;,&#39;Interest_Rate_orig_time&#39;,&#39;hpi_orig_time&#39;,&#39;age&#39;,&#39;TTM&#39;,&#39;last_time&#39;,&#39;default_time&#39;,&#39;interest_rate_mean&#39;,&#39;gdp_mean&#39;,&#39;risk_free_mean&#39;,&#39;hpi_mean&#39;,&#39;uer_mean&#39;,&#39;time_to_GFC&#39;)]

cor(variable_subset) %&gt;% knitr::kable()</code></pre>
<table style="width:100%;">
<colgroup>
<col width="6%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="5%" />
<col width="5%" />
<col width="5%" />
<col width="5%" />
<col width="5%" />
<col width="4%" />
<col width="3%" />
<col width="6%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="5%" />
<col width="3%" />
<col width="4%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">first_time</th>
<th align="right">orig_time</th>
<th align="right">mat_time</th>
<th align="right">rate_time</th>
<th align="right">REtype_CO_orig_time</th>
<th align="right">REtype_PU_orig_time</th>
<th align="right">REtype_SF_orig_time</th>
<th align="right">investor_orig_time</th>
<th align="right">balance_orig_time</th>
<th align="right">FICO_orig_time</th>
<th align="right">LTV_orig_time</th>
<th align="right">Interest_Rate_orig_time</th>
<th align="right">hpi_orig_time</th>
<th align="right">age</th>
<th align="right">TTM</th>
<th align="right">last_time</th>
<th align="right">default_time</th>
<th align="right">interest_rate_mean</th>
<th align="right">gdp_mean</th>
<th align="right">risk_free_mean</th>
<th align="right">hpi_mean</th>
<th align="right">uer_mean</th>
<th align="right">time_to_GFC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">first_time</td>
<td align="right">1.0000000</td>
<td align="right">0.7204394</td>
<td align="right">0.4121585</td>
<td align="right">0.1138200</td>
<td align="right">0.0292483</td>
<td align="right">0.0229569</td>
<td align="right">-0.0307036</td>
<td align="right">0.0116296</td>
<td align="right">0.1546413</td>
<td align="right">0.0824204</td>
<td align="right">0.0092745</td>
<td align="right">0.0687341</td>
<td align="right">0.6929031</td>
<td align="right">0.2299836</td>
<td align="right">0.1156180</td>
<td align="right">0.6148660</td>
<td align="right">0.3039482</td>
<td align="right">-0.1023105</td>
<td align="right">-0.5424740</td>
<td align="right">0.1136880</td>
<td align="right">0.1369459</td>
<td align="right">0.2936127</td>
<td align="right">-1.0000000</td>
</tr>
<tr class="even">
<td align="left">orig_time</td>
<td align="right">0.7204394</td>
<td align="right">1.0000000</td>
<td align="right">0.5918757</td>
<td align="right">-0.0615906</td>
<td align="right">0.0407945</td>
<td align="right">0.0610640</td>
<td align="right">-0.0599190</td>
<td align="right">0.0432014</td>
<td align="right">0.2098406</td>
<td align="right">0.1553459</td>
<td align="right">-0.0164785</td>
<td align="right">0.0160576</td>
<td align="right">0.9160574</td>
<td align="right">-0.5092385</td>
<td align="right">0.1846039</td>
<td align="right">0.4593792</td>
<td align="right">0.2978776</td>
<td align="right">-0.1435913</td>
<td align="right">-0.4828428</td>
<td align="right">-0.0616145</td>
<td align="right">0.1433444</td>
<td align="right">0.1679640</td>
<td align="right">-0.7204394</td>
</tr>
<tr class="odd">
<td align="left">mat_time</td>
<td align="right">0.4121585</td>
<td align="right">0.5918757</td>
<td align="right">1.0000000</td>
<td align="right">-0.0149594</td>
<td align="right">0.0350942</td>
<td align="right">0.0605812</td>
<td align="right">-0.0418815</td>
<td align="right">-0.0198346</td>
<td align="right">0.1676437</td>
<td align="right">0.0631609</td>
<td align="right">0.0632089</td>
<td align="right">-0.1081868</td>
<td align="right">0.5743841</td>
<td align="right">-0.3190921</td>
<td align="right">0.9014386</td>
<td align="right">0.2064687</td>
<td align="right">0.2295032</td>
<td align="right">-0.1050570</td>
<td align="right">-0.2702708</td>
<td align="right">-0.0153298</td>
<td align="right">0.1000367</td>
<td align="right">0.0480902</td>
<td align="right">-0.4121585</td>
</tr>
<tr class="even">
<td align="left">rate_time</td>
<td align="right">0.1138200</td>
<td align="right">-0.0615906</td>
<td align="right">-0.0149594</td>
<td align="right">1.0000000</td>
<td align="right">0.0064903</td>
<td align="right">-0.0117604</td>
<td align="right">0.0253148</td>
<td align="right">0.0114580</td>
<td align="right">-0.0313978</td>
<td align="right">-0.0780419</td>
<td align="right">0.0118861</td>
<td align="right">0.1827828</td>
<td align="right">0.1063109</td>
<td align="right">0.2276740</td>
<td align="right">0.0148391</td>
<td align="right">0.0809171</td>
<td align="right">0.1885953</td>
<td align="right">0.2813221</td>
<td align="right">-0.3139753</td>
<td align="right">0.9996952</td>
<td align="right">-0.1837950</td>
<td align="right">0.0154899</td>
<td align="right">-0.1138200</td>
</tr>
<tr class="odd">
<td align="left">REtype_CO_orig_time</td>
<td align="right">0.0292483</td>
<td align="right">0.0407945</td>
<td align="right">0.0350942</td>
<td align="right">0.0064903</td>
<td align="right">1.0000000</td>
<td align="right">-0.0965647</td>
<td align="right">-0.3415917</td>
<td align="right">0.0207958</td>
<td align="right">-0.0089662</td>
<td align="right">0.0915365</td>
<td align="right">0.0098910</td>
<td align="right">-0.0238453</td>
<td align="right">0.0521295</td>
<td align="right">-0.0209500</td>
<td align="right">0.0208812</td>
<td align="right">0.0322690</td>
<td align="right">0.0054182</td>
<td align="right">-0.0650387</td>
<td align="right">-0.0295951</td>
<td align="right">0.0063323</td>
<td align="right">0.0047353</td>
<td align="right">0.0114768</td>
<td align="right">-0.0292483</td>
</tr>
<tr class="even">
<td align="left">REtype_PU_orig_time</td>
<td align="right">0.0229569</td>
<td align="right">0.0610640</td>
<td align="right">0.0605812</td>
<td align="right">-0.0117604</td>
<td align="right">-0.0965647</td>
<td align="right">1.0000000</td>
<td align="right">-0.4690949</td>
<td align="right">-0.0166762</td>
<td align="right">0.0958164</td>
<td align="right">0.1242780</td>
<td align="right">-0.0048864</td>
<td align="right">-0.0248709</td>
<td align="right">0.0658115</td>
<td align="right">-0.0572009</td>
<td align="right">0.0410717</td>
<td align="right">0.0454316</td>
<td align="right">0.0126085</td>
<td align="right">-0.1162657</td>
<td align="right">-0.0339186</td>
<td align="right">-0.0115687</td>
<td align="right">0.0031630</td>
<td align="right">0.0253864</td>
<td align="right">-0.0229569</td>
</tr>
<tr class="odd">
<td align="left">REtype_SF_orig_time</td>
<td align="right">-0.0307036</td>
<td align="right">-0.0599190</td>
<td align="right">-0.0418815</td>
<td align="right">0.0253148</td>
<td align="right">-0.3415917</td>
<td align="right">-0.4690949</td>
<td align="right">1.0000000</td>
<td align="right">-0.1013132</td>
<td align="right">-0.0462944</td>
<td align="right">-0.1319948</td>
<td align="right">0.0041750</td>
<td align="right">-0.0137843</td>
<td align="right">-0.0682895</td>
<td align="right">0.0459809</td>
<td align="right">-0.0188856</td>
<td align="right">-0.0405454</td>
<td align="right">-0.0039875</td>
<td align="right">0.0730690</td>
<td align="right">0.0052115</td>
<td align="right">0.0252423</td>
<td align="right">-0.0541469</td>
<td align="right">-0.0119068</td>
<td align="right">0.0307036</td>
</tr>
<tr class="even">
<td align="left">investor_orig_time</td>
<td align="right">0.0116296</td>
<td align="right">0.0432014</td>
<td align="right">-0.0198346</td>
<td align="right">0.0114580</td>
<td align="right">0.0207958</td>
<td align="right">-0.0166762</td>
<td align="right">-0.1013132</td>
<td align="right">1.0000000</td>
<td align="right">-0.1168575</td>
<td align="right">0.1699794</td>
<td align="right">-0.0639457</td>
<td align="right">0.0956060</td>
<td align="right">0.0435371</td>
<td align="right">-0.0461916</td>
<td align="right">-0.0473878</td>
<td align="right">0.0412416</td>
<td align="right">0.0339573</td>
<td align="right">0.0340316</td>
<td align="right">-0.0332389</td>
<td align="right">0.0114132</td>
<td align="right">-0.0052367</td>
<td align="right">0.0242550</td>
<td align="right">-0.0116296</td>
</tr>
<tr class="odd">
<td align="left">balance_orig_time</td>
<td align="right">0.1546413</td>
<td align="right">0.2098406</td>
<td align="right">0.1676437</td>
<td align="right">-0.0313978</td>
<td align="right">-0.0089662</td>
<td align="right">0.0958164</td>
<td align="right">-0.0462944</td>
<td align="right">-0.1168575</td>
<td align="right">1.0000000</td>
<td align="right">0.3229090</td>
<td align="right">-0.1935153</td>
<td align="right">-0.0835764</td>
<td align="right">0.1884202</td>
<td align="right">-0.1025605</td>
<td align="right">0.0917100</td>
<td align="right">0.1515442</td>
<td align="right">-0.0010766</td>
<td align="right">-0.3375744</td>
<td align="right">-0.1397382</td>
<td align="right">-0.0314263</td>
<td align="right">-0.0176242</td>
<td align="right">0.1100034</td>
<td align="right">-0.1546413</td>
</tr>
<tr class="even">
<td align="left">FICO_orig_time</td>
<td align="right">0.0824204</td>
<td align="right">0.1553459</td>
<td align="right">0.0631609</td>
<td align="right">-0.0780419</td>
<td align="right">0.0915365</td>
<td align="right">0.1242780</td>
<td align="right">-0.1319948</td>
<td align="right">0.1699794</td>
<td align="right">0.3229090</td>
<td align="right">1.0000000</td>
<td align="right">-0.0995956</td>
<td align="right">-0.0710463</td>
<td align="right">0.1558017</td>
<td align="right">-0.1157125</td>
<td align="right">-0.0064203</td>
<td align="right">0.2040493</td>
<td align="right">-0.1082498</td>
<td align="right">-0.5259041</td>
<td align="right">-0.1282160</td>
<td align="right">-0.0777834</td>
<td align="right">-0.0048778</td>
<td align="right">0.1430426</td>
<td align="right">-0.0824204</td>
</tr>
<tr class="odd">
<td align="left">LTV_orig_time</td>
<td align="right">0.0092745</td>
<td align="right">-0.0164785</td>
<td align="right">0.0632089</td>
<td align="right">0.0118861</td>
<td align="right">0.0098910</td>
<td align="right">-0.0048864</td>
<td align="right">0.0041750</td>
<td align="right">-0.0639457</td>
<td align="right">-0.1935153</td>
<td align="right">-0.0995956</td>
<td align="right">1.0000000</td>
<td align="right">-0.0021603</td>
<td align="right">-0.0174270</td>
<td align="right">0.0346331</td>
<td align="right">0.0859226</td>
<td align="right">-0.0590717</td>
<td align="right">0.0888124</td>
<td align="right">0.2030012</td>
<td align="right">0.0499672</td>
<td align="right">0.0119659</td>
<td align="right">0.0528514</td>
<td align="right">-0.0554563</td>
<td align="right">-0.0092745</td>
</tr>
<tr class="even">
<td align="left">Interest_Rate_orig_time</td>
<td align="right">0.0687341</td>
<td align="right">0.0160576</td>
<td align="right">-0.1081868</td>
<td align="right">0.1827828</td>
<td align="right">-0.0238453</td>
<td align="right">-0.0248709</td>
<td align="right">-0.0137843</td>
<td align="right">0.0956060</td>
<td align="right">-0.0835764</td>
<td align="right">-0.0710463</td>
<td align="right">-0.0021603</td>
<td align="right">1.0000000</td>
<td align="right">0.0467439</td>
<td align="right">0.0627628</td>
<td align="right">-0.1405393</td>
<td align="right">0.0873160</td>
<td align="right">0.1052690</td>
<td align="right">0.2503181</td>
<td align="right">-0.1808460</td>
<td align="right">0.1828129</td>
<td align="right">-0.1402862</td>
<td align="right">0.0448506</td>
<td align="right">-0.0687341</td>
</tr>
<tr class="odd">
<td align="left">hpi_orig_time</td>
<td align="right">0.6929031</td>
<td align="right">0.9160574</td>
<td align="right">0.5743841</td>
<td align="right">0.1063109</td>
<td align="right">0.0521295</td>
<td align="right">0.0658115</td>
<td align="right">-0.0682895</td>
<td align="right">0.0435371</td>
<td align="right">0.1884202</td>
<td align="right">0.1558017</td>
<td align="right">-0.0174270</td>
<td align="right">0.0467439</td>
<td align="right">1.0000000</td>
<td align="right">-0.4256156</td>
<td align="right">0.2083603</td>
<td align="right">0.4535288</td>
<td align="right">0.3074560</td>
<td align="right">-0.1397604</td>
<td align="right">-0.4880450</td>
<td align="right">0.1062585</td>
<td align="right">0.2426822</td>
<td align="right">0.0863770</td>
<td align="right">-0.6929031</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">0.2299836</td>
<td align="right">-0.5092385</td>
<td align="right">-0.3190921</td>
<td align="right">0.2276740</td>
<td align="right">-0.0209500</td>
<td align="right">-0.0572009</td>
<td align="right">0.0459809</td>
<td align="right">-0.0461916</td>
<td align="right">-0.1025605</td>
<td align="right">-0.1157125</td>
<td align="right">0.0346331</td>
<td align="right">0.0627628</td>
<td align="right">-0.4256156</td>
<td align="right">1.0000000</td>
<td align="right">-0.1155728</td>
<td align="right">0.1183877</td>
<td align="right">-0.0408169</td>
<td align="right">0.0745348</td>
<td align="right">0.0043735</td>
<td align="right">0.2275439</td>
<td align="right">-0.0312074</td>
<td align="right">0.1286613</td>
<td align="right">-0.2299836</td>
</tr>
<tr class="odd">
<td align="left">TTM</td>
<td align="right">0.1156180</td>
<td align="right">0.1846039</td>
<td align="right">0.9014386</td>
<td align="right">0.0148391</td>
<td align="right">0.0208812</td>
<td align="right">0.0410717</td>
<td align="right">-0.0188856</td>
<td align="right">-0.0473878</td>
<td align="right">0.0917100</td>
<td align="right">-0.0064203</td>
<td align="right">0.0859226</td>
<td align="right">-0.1405393</td>
<td align="right">0.2083603</td>
<td align="right">-0.1155728</td>
<td align="right">1.0000000</td>
<td align="right">0.0050268</td>
<td align="right">0.1198535</td>
<td align="right">-0.0509779</td>
<td align="right">-0.0702203</td>
<td align="right">0.0144003</td>
<td align="right">0.0449892</td>
<td align="right">-0.0315734</td>
<td align="right">-0.1156180</td>
</tr>
<tr class="even">
<td align="left">last_time</td>
<td align="right">0.6148660</td>
<td align="right">0.4593792</td>
<td align="right">0.2064687</td>
<td align="right">0.0809171</td>
<td align="right">0.0322690</td>
<td align="right">0.0454316</td>
<td align="right">-0.0405454</td>
<td align="right">0.0412416</td>
<td align="right">0.1515442</td>
<td align="right">0.2040493</td>
<td align="right">-0.0590717</td>
<td align="right">0.0873160</td>
<td align="right">0.4535288</td>
<td align="right">0.1183877</td>
<td align="right">0.0050268</td>
<td align="right">1.0000000</td>
<td align="right">0.2975575</td>
<td align="right">-0.2200291</td>
<td align="right">-0.6949821</td>
<td align="right">0.0814640</td>
<td align="right">-0.2450211</td>
<td align="right">0.7209687</td>
<td align="right">-0.6148660</td>
</tr>
<tr class="odd">
<td align="left">default_time</td>
<td align="right">0.3039482</td>
<td align="right">0.2978776</td>
<td align="right">0.2295032</td>
<td align="right">0.1885953</td>
<td align="right">0.0054182</td>
<td align="right">0.0126085</td>
<td align="right">-0.0039875</td>
<td align="right">0.0339573</td>
<td align="right">-0.0010766</td>
<td align="right">-0.1082498</td>
<td align="right">0.0888124</td>
<td align="right">0.1052690</td>
<td align="right">0.3074560</td>
<td align="right">-0.0408169</td>
<td align="right">0.1198535</td>
<td align="right">0.2975575</td>
<td align="right">1.0000000</td>
<td align="right">0.1516563</td>
<td align="right">-0.4493496</td>
<td align="right">0.1884337</td>
<td align="right">-0.1671072</td>
<td align="right">0.1808916</td>
<td align="right">-0.3039482</td>
</tr>
<tr class="even">
<td align="left">interest_rate_mean</td>
<td align="right">-0.1023105</td>
<td align="right">-0.1435913</td>
<td align="right">-0.1050570</td>
<td align="right">0.2813221</td>
<td align="right">-0.0650387</td>
<td align="right">-0.1162657</td>
<td align="right">0.0730690</td>
<td align="right">0.0340316</td>
<td align="right">-0.3375744</td>
<td align="right">-0.5259041</td>
<td align="right">0.2030012</td>
<td align="right">0.2503181</td>
<td align="right">-0.1397604</td>
<td align="right">0.0745348</td>
<td align="right">-0.0509779</td>
<td align="right">-0.2200291</td>
<td align="right">0.1516563</td>
<td align="right">1.0000000</td>
<td align="right">-0.0229672</td>
<td align="right">0.2810567</td>
<td align="right">-0.1204072</td>
<td align="right">-0.1729804</td>
<td align="right">0.1023105</td>
</tr>
<tr class="odd">
<td align="left">gdp_mean</td>
<td align="right">-0.5424740</td>
<td align="right">-0.4828428</td>
<td align="right">-0.2702708</td>
<td align="right">-0.3139753</td>
<td align="right">-0.0295951</td>
<td align="right">-0.0339186</td>
<td align="right">0.0052115</td>
<td align="right">-0.0332389</td>
<td align="right">-0.1397382</td>
<td align="right">-0.1282160</td>
<td align="right">0.0499672</td>
<td align="right">-0.1808460</td>
<td align="right">-0.4880450</td>
<td align="right">0.0043735</td>
<td align="right">-0.0702203</td>
<td align="right">-0.6949821</td>
<td align="right">-0.4493496</td>
<td align="right">-0.0229672</td>
<td align="right">1.0000000</td>
<td align="right">-0.3140921</td>
<td align="right">0.4424599</td>
<td align="right">-0.5565366</td>
<td align="right">0.5424740</td>
</tr>
<tr class="even">
<td align="left">risk_free_mean</td>
<td align="right">0.1136880</td>
<td align="right">-0.0616145</td>
<td align="right">-0.0153298</td>
<td align="right">0.9996952</td>
<td align="right">0.0063323</td>
<td align="right">-0.0115687</td>
<td align="right">0.0252423</td>
<td align="right">0.0114132</td>
<td align="right">-0.0314263</td>
<td align="right">-0.0777834</td>
<td align="right">0.0119659</td>
<td align="right">0.1828129</td>
<td align="right">0.1062585</td>
<td align="right">0.2275439</td>
<td align="right">0.0144003</td>
<td align="right">0.0814640</td>
<td align="right">0.1884337</td>
<td align="right">0.2810567</td>
<td align="right">-0.3140921</td>
<td align="right">1.0000000</td>
<td align="right">-0.1840000</td>
<td align="right">0.0159213</td>
<td align="right">-0.1136880</td>
</tr>
<tr class="odd">
<td align="left">hpi_mean</td>
<td align="right">0.1369459</td>
<td align="right">0.1433444</td>
<td align="right">0.1000367</td>
<td align="right">-0.1837950</td>
<td align="right">0.0047353</td>
<td align="right">0.0031630</td>
<td align="right">-0.0541469</td>
<td align="right">-0.0052367</td>
<td align="right">-0.0176242</td>
<td align="right">-0.0048778</td>
<td align="right">0.0528514</td>
<td align="right">-0.1402862</td>
<td align="right">0.2426822</td>
<td align="right">-0.0312074</td>
<td align="right">0.0449892</td>
<td align="right">-0.2450211</td>
<td align="right">-0.1671072</td>
<td align="right">-0.1204072</td>
<td align="right">0.4424599</td>
<td align="right">-0.1840000</td>
<td align="right">1.0000000</td>
<td align="right">-0.6671533</td>
<td align="right">-0.1369459</td>
</tr>
<tr class="even">
<td align="left">uer_mean</td>
<td align="right">0.2936127</td>
<td align="right">0.1679640</td>
<td align="right">0.0480902</td>
<td align="right">0.0154899</td>
<td align="right">0.0114768</td>
<td align="right">0.0253864</td>
<td align="right">-0.0119068</td>
<td align="right">0.0242550</td>
<td align="right">0.1100034</td>
<td align="right">0.1430426</td>
<td align="right">-0.0554563</td>
<td align="right">0.0448506</td>
<td align="right">0.0863770</td>
<td align="right">0.1286613</td>
<td align="right">-0.0315734</td>
<td align="right">0.7209687</td>
<td align="right">0.1808916</td>
<td align="right">-0.1729804</td>
<td align="right">-0.5565366</td>
<td align="right">0.0159213</td>
<td align="right">-0.6671533</td>
<td align="right">1.0000000</td>
<td align="right">-0.2936127</td>
</tr>
<tr class="odd">
<td align="left">time_to_GFC</td>
<td align="right">-1.0000000</td>
<td align="right">-0.7204394</td>
<td align="right">-0.4121585</td>
<td align="right">-0.1138200</td>
<td align="right">-0.0292483</td>
<td align="right">-0.0229569</td>
<td align="right">0.0307036</td>
<td align="right">-0.0116296</td>
<td align="right">-0.1546413</td>
<td align="right">-0.0824204</td>
<td align="right">-0.0092745</td>
<td align="right">-0.0687341</td>
<td align="right">-0.6929031</td>
<td align="right">-0.2299836</td>
<td align="right">-0.1156180</td>
<td align="right">-0.6148660</td>
<td align="right">-0.3039482</td>
<td align="right">0.1023105</td>
<td align="right">0.5424740</td>
<td align="right">-0.1136880</td>
<td align="right">-0.1369459</td>
<td align="right">-0.2936127</td>
<td align="right">1.0000000</td>
</tr>
</tbody>
</table>
<p>Now I will make run a regression between default_rate and each variable and plot them with ggplot. For values like GDP,House Price Index, Unemployment Rate with both mean and first-time value, I will only focus on the one with stronger correlation to default rate.I will start by the one with the strongest to the weakest.</p>
<pre class="r"><code>cor(variable_subset,variable_subset$default_time) </code></pre>
<pre><code>##                                 [,1]
## first_time               0.303948205
## orig_time                0.297877579
## mat_time                 0.229503177
## rate_time                0.188595324
## REtype_CO_orig_time      0.005418208
## REtype_PU_orig_time      0.012608515
## REtype_SF_orig_time     -0.003987520
## investor_orig_time       0.033957315
## balance_orig_time       -0.001076587
## FICO_orig_time          -0.108249816
## LTV_orig_time            0.088812382
## Interest_Rate_orig_time  0.105268981
## hpi_orig_time            0.307455995
## age                     -0.040816929
## TTM                      0.119853510
## last_time                0.297557465
## default_time             1.000000000
## interest_rate_mean       0.151656297
## gdp_mean                -0.449349609
## risk_free_mean           0.188433686
## hpi_mean                -0.167107236
## uer_mean                 0.180891564
## time_to_GFC             -0.303948205</code></pre>
<p>mean GDP:</p>
<pre class="r"><code>library(modelr)
mor_mod &lt;- glm(default_time ~ gdp_mean, data = mortgage_all, family = binomial)
(beta &lt;- coef(mor_mod))</code></pre>
<pre><code>## (Intercept)    gdp_mean 
##   1.0324845  -0.8995499</code></pre>
<pre class="r"><code>library(modelr)
(grid &lt;- mortgage_all %&gt;% data_grid(gdp_mean) %&gt;%
 add_predictions(mor_mod, type = &quot;response&quot;))</code></pre>
<pre><code>## # A tibble: 1,447 x 2
##    gdp_mean  pred
##       &lt;dbl&gt; &lt;dbl&gt;
##  1    -3.83 0.989
##  2    -3.74 0.988
##  3    -3.67 0.987
##  4    -3.52 0.985
##  5    -3.16 0.980
##  6    -2.82 0.973
##  7    -2.81 0.972
##  8    -2.70 0.969
##  9    -2.58 0.966
## 10    -2.39 0.960
## # … with 1,437 more rows</code></pre>
<pre class="r"><code>ggplot(mortgage_all, aes(gdp_mean)) + geom_point(aes(y = default_time),alpha = 0.005) +
 geom_line(aes(y = pred), data = grid, color = &quot;red&quot;, size = 1)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/q10-1.png" width="672" /></p>
<p>pattern:
As gdp mean increases roughly from 3.75 to 5.0, the default rate shows a decrease pattern from 1 to 0. The dots are mainly gathered from 0 to 2.5 gdp mean for both default and pay-off.</p>
<p>Original House Price Index:</p>
<pre class="r"><code>mor_mod1 &lt;- glm(default_time ~ hpi_orig_time, data = mortgage_all, family = binomial)
(beta &lt;- coef(mor_mod1))</code></pre>
<pre><code>##   (Intercept) hpi_orig_time 
##   -5.41944535    0.02425822</code></pre>
<pre class="r"><code>library(modelr)
(grid &lt;- mortgage_all %&gt;% data_grid(hpi_orig_time) %&gt;%
 add_predictions(mor_mod1, type = &quot;response&quot;))</code></pre>
<pre><code>## # A tibble: 87 x 2
##    hpi_orig_time   pred
##            &lt;dbl&gt;  &lt;dbl&gt;
##  1          75.7 0.0270
##  2          75.7 0.0271
##  3          75.9 0.0272
##  4          76.4 0.0275
##  5          76.5 0.0275
##  6          76.5 0.0275
##  7          76.7 0.0277
##  8          76.9 0.0278
##  9          77.0 0.0279
## 10          77   0.0279
## # … with 77 more rows</code></pre>
<pre class="r"><code>ggplot(mortgage_all, aes(hpi_orig_time)) + geom_point(aes(y = default_time),alpha = 0.005) +
 geom_line(aes(y = pred), data = grid, color = &quot;red&quot;, size = 1)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/q11-1.png" width="672" /></p>
<p>pattern:
There is a weak correlation between the original house price index (base year = 100) and default rate. As the original house price index increases from 75 to 200, the default rate increases at the same time from 0 to 0.5.</p>
<p>For time varible, I will keep only origin time of the dataset:</p>
<pre class="r"><code>mor_mod2 &lt;- glm(default_time ~ orig_time, data = mortgage_all, family = binomial)
(beta &lt;- coef(mor_mod2))</code></pre>
<pre><code>## (Intercept)   orig_time 
##  -3.1697610   0.1243071</code></pre>
<pre class="r"><code>library(modelr)
(grid &lt;- mortgage_all %&gt;% data_grid(orig_time) %&gt;%
 add_predictions(mor_mod2, type = &quot;response&quot;))</code></pre>
<pre><code>## # A tibble: 88 x 2
##    orig_time     pred
##        &lt;dbl&gt;    &lt;dbl&gt;
##  1       -40 0.000291
##  2       -39 0.000329
##  3       -37 0.000422
##  4       -36 0.000478
##  5       -33 0.000694
##  6       -30 0.00101 
##  7       -29 0.00114 
##  8       -28 0.00129 
##  9       -26 0.00166 
## 10       -25 0.00187 
## # … with 78 more rows</code></pre>
<pre class="r"><code>ggplot(mortgage_all, aes(orig_time)) + geom_point(aes(y = default_time),alpha = 0.005) +
 geom_line(aes(y = pred), data = grid, color = &quot;red&quot;, size = 1)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/q12-1.png" width="672" /></p>
<p>pattern:
As we can see, the default rate tends to be 0 when time stamp for start of the mortgage from -40 to 0. The default rate increases dramatically from 0 to 40, and remains at 1 from 40 to 60.</p>
<p>First time Risk-free rate:</p>
<pre class="r"><code>mor_mod4 &lt;- glm(default_time ~ rate_time, data = mortgage_all, family = binomial)
(beta &lt;- coef(mor_mod4))</code></pre>
<pre><code>## (Intercept)   rate_time 
##  -4.2555650   0.8188854</code></pre>
<pre class="r"><code>library(modelr)
(grid &lt;- mortgage_all %&gt;% data_grid(rate_time) %&gt;%
 add_predictions(mor_mod4, type = &quot;response&quot;))</code></pre>
<pre><code>## # A tibble: 81 x 2
##    rate_time   pred
##        &lt;dbl&gt;  &lt;dbl&gt;
##  1      1.65 0.0519
##  2      1.67 0.0527
##  3      1.78 0.0574
##  4      1.87 0.0616
##  5      1.89 0.0625
##  6      1.92 0.0640
##  7      1.94 0.0650
##  8      2.17 0.0774
##  9      2.23 0.0810
## 10      2.52 0.100 
## # … with 71 more rows</code></pre>
<pre class="r"><code>ggplot(mortgage_all, aes(rate_time)) + geom_point(aes(y = default_time),alpha = 0.005) +
 geom_line(aes(y = pred), data = grid, color = &quot;red&quot;, size = 1)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/q13-1.png" width="672" /></p>
<p>Pattern:
There is a strong correlation between these two variables. As first time risk-free rate increases, the default rate increases dramatically from 0 to 1.</p>
<p>Unemployment Rate:</p>
<pre class="r"><code>mor_mod5 &lt;- glm(default_time ~ uer_mean, data = mortgage_all, family = binomial)
(beta &lt;- coef(mor_mod5))</code></pre>
<pre><code>## (Intercept)    uer_mean 
##  -2.5602844   0.3632487</code></pre>
<pre class="r"><code>library(modelr)
(grid &lt;- mortgage_all %&gt;% data_grid(uer_mean) %&gt;%
 add_predictions(mor_mod5, type = &quot;response&quot;))</code></pre>
<pre><code>## # A tibble: 1,113 x 2
##    uer_mean  pred
##       &lt;dbl&gt; &lt;dbl&gt;
##  1     3.8  0.235
##  2     3.9  0.242
##  3     3.95 0.245
##  4     3.98 0.247
##  5     4    0.248
##  6     4.03 0.251
##  7     4.05 0.252
##  8     4.06 0.252
##  9     4.12 0.257
## 10     4.15 0.259
## # … with 1,103 more rows</code></pre>
<pre class="r"><code>ggplot(mortgage_all, aes(uer_mean)) + geom_point(aes(y = default_time),alpha = 0.005) +
 geom_line(aes(y = pred), data = grid, color = &quot;red&quot;, size = 1)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/q14-1.png" width="672" /></p>
<p>Pattern:
There is a positive linear relationship between the average unemployment rate and default rate. As the average unemployment rate increases from roughly 4 to 10, the default rate increases from 0.25 to 0.75.</p>
<p>Mean Interest Rate:</p>
<pre class="r"><code>mor_mod6 &lt;- glm(default_time ~ interest_rate_mean, data = mortgage_all, family = binomial)
(beta &lt;- coef(mor_mod6))</code></pre>
<pre><code>##        (Intercept) interest_rate_mean 
##         -1.9736370          0.1906897</code></pre>
<pre class="r"><code>library(modelr)
(grid &lt;- mortgage_all %&gt;% data_grid(interest_rate_mean) %&gt;%
 add_predictions(mor_mod6, type = &quot;response&quot;))</code></pre>
<pre><code>## # A tibble: 7,527 x 2
##    interest_rate_mean  pred
##                 &lt;dbl&gt; &lt;dbl&gt;
##  1               1.12 0.147
##  2               1.72 0.162
##  3               1.75 0.162
##  4               1.99 0.169
##  5               1.99 0.169
##  6               2.00 0.169
##  7               2    0.169
##  8               2.00 0.169
##  9               2.01 0.169
## 10               2.02 0.170
## # … with 7,517 more rows</code></pre>
<pre class="r"><code>ggplot(mortgage_all, aes(interest_rate_mean)) + geom_point(aes(y = default_time),alpha = 0.005) +
 geom_line(aes(y = pred), data = grid, color = &quot;red&quot;, size = 1)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/q15-1.png" width="672" /></p>
<p>Pattern:
The default rate increases dramatically as the average interest rate of all observation periods from roughly 2 to 20, and default rate tends to be flat from 20 to roughly 37.</p>
<p>Time to Maturity:</p>
<pre class="r"><code>mor_mod7 &lt;- glm(default_time ~ TTM, data = mortgage_all, family = binomial)
(beta &lt;- coef(mor_mod7))</code></pre>
<pre><code>## (Intercept)         TTM 
## -3.22550171  0.02253902</code></pre>
<pre class="r"><code>library(modelr)
(grid &lt;- mortgage_all %&gt;% data_grid(TTM) %&gt;%
 add_predictions(mor_mod7, type = &quot;response&quot;))</code></pre>
<pre><code>## # A tibble: 146 x 2
##      TTM   pred
##    &lt;dbl&gt;  &lt;dbl&gt;
##  1     5 0.0426
##  2     9 0.0464
##  3    10 0.0474
##  4    11 0.0484
##  5    13 0.0506
##  6    14 0.0517
##  7    15 0.0528
##  8    16 0.0539
##  9    17 0.0551
## 10    18 0.0563
## # … with 136 more rows</code></pre>
<pre class="r"><code>ggplot(mortgage_all, aes(TTM)) + geom_point(aes(y = default_time),alpha = 0.005) +
 geom_line(aes(y = pred), data = grid, color = &quot;red&quot;, size = 1)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/q16-1.png" width="672" /></p>
<p>Pattern:
There is a positive non-linear relationship between scheduled time to maturity and default rate. The slope increases slowly at the beginning, and start to increase relative deeply at roughly 100.</p>
<p>FICO score(credit score):</p>
<pre class="r"><code>mor_mod8 &lt;- glm(default_time ~ FICO_orig_time, data = mortgage_all, family = binomial)
(beta &lt;- coef(mor_mod8))</code></pre>
<pre><code>##    (Intercept) FICO_orig_time 
##    1.497799187   -0.003128735</code></pre>
<pre class="r"><code>library(modelr)
(grid &lt;- mortgage_all %&gt;% data_grid(FICO_orig_time) %&gt;%
 add_predictions(mor_mod8, type = &quot;response&quot;))</code></pre>
<pre><code>## # A tibble: 389 x 2
##    FICO_orig_time  pred
##             &lt;dbl&gt; &lt;dbl&gt;
##  1            400 0.561
##  2            406 0.557
##  3            413 0.551
##  4            420 0.546
##  5            428 0.540
##  6            429 0.539
##  7            433 0.536
##  8            439 0.531
##  9            441 0.529
## 10            442 0.529
## # … with 379 more rows</code></pre>
<pre class="r"><code>ggplot(mortgage_all, aes(FICO_orig_time)) + geom_point(aes(y = default_time),alpha = 0.005) +
 geom_line(aes(y = pred), data = grid, color = &quot;red&quot;, size = 1)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/q17-1.png" width="672" /></p>
<p>pattern:
The correlation between default rate and FICO score(credit score) at origination time is negative and weak, which indicates a small correlation between these two variables.</p>
<p>Loan to Value ratio:</p>
<pre class="r"><code>mor_mod9 &lt;- glm(default_time ~ LTV_orig_time, data = mortgage_all, family = binomial)
(beta &lt;- coef(mor_mod9))</code></pre>
<pre><code>##   (Intercept) LTV_orig_time 
##   -2.09611716    0.01917789</code></pre>
<pre class="r"><code>library(modelr)
(grid &lt;- mortgage_all %&gt;% data_grid(LTV_orig_time) %&gt;%
 add_predictions(mor_mod9, type = &quot;response&quot;))</code></pre>
<pre><code>## # A tibble: 538 x 2
##    LTV_orig_time  pred
##            &lt;dbl&gt; &lt;dbl&gt;
##  1          50.1 0.243
##  2          50.2 0.244
##  3          50.3 0.244
##  4          50.4 0.244
##  5          50.5 0.245
##  6          50.6 0.245
##  7          50.7 0.245
##  8          50.8 0.246
##  9          50.9 0.246
## 10          51   0.246
## # … with 528 more rows</code></pre>
<pre class="r"><code>ggplot(mortgage_all, aes(LTV_orig_time)) + geom_point(aes(y = default_time),alpha = 0.005) +
 geom_line(aes(y = pred), data = grid, color = &quot;red&quot;, size = 1)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/q18-1.png" width="672" /></p>
<p>Pattern:
The correlation here looks pretty steady, except a little twit around LTV_orig_time = 175. This indicates an overall stable positive linear correlation between default time and loan-to-value ratio.</p>
<p>age of a mortgage:</p>
<pre class="r"><code>mor_mod10 &lt;- glm(default_time ~ age, data = mortgage_all, family = binomial)
(beta &lt;- coef(mor_mod10))</code></pre>
<pre><code>## (Intercept)         age 
## -0.49817484 -0.01776127</code></pre>
<pre class="r"><code>library(modelr)
(grid &lt;- mortgage_all %&gt;% data_grid(age) %&gt;%
 add_predictions(mor_mod10, type = &quot;response&quot;))</code></pre>
<pre><code>## # A tibble: 66 x 2
##      age  pred
##    &lt;dbl&gt; &lt;dbl&gt;
##  1     0 0.378
##  2     1 0.374
##  3     2 0.370
##  4     3 0.366
##  5     4 0.361
##  6     5 0.357
##  7     6 0.353
##  8     7 0.349
##  9     8 0.345
## 10     9 0.341
## # … with 56 more rows</code></pre>
<pre class="r"><code>ggplot(mortgage_all, aes(age)) + geom_point(aes(y = default_time),alpha = 0.005) +
 geom_line(aes(y = pred), data = grid, color = &quot;red&quot;, size = 1)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/q19-1.png" width="672" /></p>
<p>pattern:
The correlation here looks negatively linear but not strong, since the correlation line is relatively flat, which indicates a small tangent and small correlation between these two variables.</p>
<p>Investor Type:</p>
<pre class="r"><code>ggplot(data=mortgage_all, mapping=aes(x= investor_orig_time,y=REtype_SF_orig_time))+
  geom_bar(stat=&quot;identity&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/q20-1.png" width="672" /></p>
<p>Pattern:</p>
<p>Value of the house:</p>
<pre class="r"><code>mor_mod12 &lt;- glm(default_time ~ balance_orig_time, data = mortgage_all, family = binomial)
(beta &lt;- coef(mor_mod12))</code></pre>
<pre><code>##       (Intercept) balance_orig_time 
##     -5.567810e-01     -1.075221e-08</code></pre>
<pre class="r"><code>library(modelr)
(grid &lt;- mortgage_all %&gt;% data_grid(balance_orig_time) %&gt;%
 add_predictions(mor_mod12, type = &quot;response&quot;))</code></pre>
<pre><code>## # A tibble: 9,409 x 2
##    balance_orig_time  pred
##                &lt;dbl&gt; &lt;dbl&gt;
##  1                0  0.364
##  2             6246  0.364
##  3             9575  0.364
##  4            10000  0.364
##  5            10465. 0.364
##  6            11100  0.364
##  7            11400  0.364
##  8            11845. 0.364
##  9            12000  0.364
## 10            12008  0.364
## # … with 9,399 more rows</code></pre>
<pre class="r"><code>ggplot(mortgage_all, aes(balance_orig_time)) + geom_point(aes(y = default_time),alpha = 0.005) +
 geom_line(aes(y = pred), data = grid, color = &quot;red&quot;, size = 1)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/q21-1.png" width="672" /></p>
<p>Pattern:
There is almost no correlation between value of the house and default rate. The correlation line is totally flat, which means value of the house does not affect default time.</p>
<p>REtype_CO_orig_tim:condominium:</p>
<pre class="r"><code>ggplot(data=mortgage_all, mapping=aes(x=default_time,y=REtype_CO_orig_time))+
  geom_bar(stat=&quot;identity&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/q22-1.png" width="672" /></p>
<p>Pattern:
The ratio of pay-off to default in condominium is around 1:2, with pay-off approximately 1000 and default approximately 2000. This type of real estate has the largest difference in ratio between payoff and default.</p>
<p>REtype_PU_orig_time real estate type planned urban developments:</p>
<pre class="r"><code>ggplot(data=mortgage_all, mapping=aes(x=default_time,y=REtype_PU_orig_time))+
  geom_bar(stat=&quot;identity&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/q23-1.png" width="672" /></p>
<p>Pattern:
The ratio of pay-off to default in planned urban developments is around 3:5, with pay-off approximately 1800 and default approximately 3000.</p>
<p>REtype_SF_orig_time single family home:</p>
<pre class="r"><code>ggplot(data=mortgage_all, mapping=aes(x=default_time,y=REtype_SF_orig_time))+
  geom_bar(stat=&quot;identity&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/q24-1.png" width="672" /></p>
<p>Pattern:
The ratio of pay-off to default in single family home is around 19:33, with pay-off approximately 9500 and default approximately 16500. This type of real estate has the most counts.
So, after ploting all these varible, we are now able to complete our full regression model:</p>
<pre class="r"><code>library(modelr)
glm(default_time ~ age + first_time+REtype_CO_orig_time+REtype_PU_orig_time+REtype_SF_orig_time+
interest_rate_mean+gdp_mean+rate_time+hpi_orig_time+uer_mean+investor_orig_time+balance_orig_time+FICO_orig_time+LTV_orig_time+TTM- 1 , data = mortgage_all, family = binomial) %&gt;% broom::tidy()</code></pre>
<pre><code>## # A tibble: 15 x 5
##    term                estimate    std.error statistic   p.value
##    &lt;chr&gt;                  &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 age                 -1.91e-2 0.00502        -3.81   1.38e-  4
##  2 first_time           2.27e-2 0.00489         4.65   3.35e-  6
##  3 REtype_CO_orig_time -1.05e-2 0.0540         -0.194  8.46e-  1
##  4 REtype_PU_orig_time  7.95e-2 0.0446          1.78   7.48e-  2
##  5 REtype_SF_orig_time -8.40e-2 0.0315         -2.67   7.62e-  3
##  6 interest_rate_mean   7.94e-2 0.00858         9.25   2.29e- 20
##  7 gdp_mean            -9.64e-1 0.0145        -66.3    0        
##  8 rate_time            8.65e-2 0.0287          3.01   2.62e-  3
##  9 hpi_orig_time        5.48e-3 0.000974        5.62   1.89e-  8
## 10 uer_mean            -1.44e-1 0.0128        -11.2    3.14e- 29
## 11 investor_orig_time   4.06e-1 0.0391         10.4    3.20e- 25
## 12 balance_orig_time   -5.74e-9 0.0000000641   -0.0895 9.29e-  1
## 13 FICO_orig_time      -6.32e-3 0.000185      -34.2    2.96e-256
## 14 LTV_orig_time        2.34e-2 0.00130        18.1    3.16e- 73
## 15 TTM                  1.39e-2 0.000991       14.0    1.22e- 44</code></pre>
<p>As we can see from the chart, condominium or not, planned urban developments or not, the value of the house, is not statistically significant. Therefore, we will kick them out od our model.</p>
<pre class="r"><code>library(modelr)
glm(default_time ~ age + first_time+REtype_SF_orig_time+interest_rate_mean+gdp_mean+rate_time+hpi_orig_time+uer_mean+investor_orig_time+FICO_orig_time+LTV_orig_time+TTM- 1 , data = mortgage_all, family = binomial) %&gt;% broom::tidy()</code></pre>
<pre><code>## # A tibble: 12 x 5
##    term                estimate std.error statistic   p.value
##    &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 age                 -0.0192   0.00500      -3.85 1.18e-  4
##  2 first_time           0.0226   0.00486       4.65 3.27e-  6
##  3 REtype_SF_orig_time -0.107    0.0249       -4.29 1.82e-  5
##  4 interest_rate_mean   0.0786   0.00846       9.29 1.58e- 20
##  5 gdp_mean            -0.964    0.0145      -66.3  0        
##  6 rate_time            0.0880   0.0287        3.07 2.13e-  3
##  7 hpi_orig_time        0.00549  0.000973      5.64 1.68e-  8
##  8 uer_mean            -0.144    0.0128      -11.2  3.52e- 29
##  9 investor_orig_time   0.401    0.0383       10.5  1.34e- 25
## 10 FICO_orig_time      -0.00631  0.000179    -35.3  7.50e-273
## 11 LTV_orig_time        0.0235   0.00128      18.4  1.39e- 75
## 12 TTM                  0.0140   0.000987     14.1  2.31e- 45</code></pre>
<p>Generally speaking, GDP growth, uemployment rate,and the mean interest rate is still the outside dominant factor that may influence one’s default rate. In addition to that, investor house or not， loan to house value ratio, time to maturity are also the inside factor that determines one’s default rate.Therefore, whether one will default or not in a mortgage is strongly related to both the economy of the country and the types of specific mortgage.</p>
